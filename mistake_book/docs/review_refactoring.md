# 复习功能重构说明

## 重构原因
原有的复习功能直接复习所有到期题目，缺乏灵活性：
1. 无法选择特定科目或题型
2. 一次性复习所有题目可能太多
3. 用户希望分模块、分批次复习

## 重构方案

### 第一阶段：模块选择（已完成）
实现复习模块选择对话框，让用户可以选择要复习的科目和题型。

**已完成：**
- ✅ 创建`ReviewModuleSelectorDialog`
- ✅ 显示科目和题型列表
- ✅ 统计每个模块的题目数量
- ✅ 支持选择特定模块或全部复习
- ✅ 集成到主窗口的复习流程

**已删除：**
- ❌ 旧的`ReviewDialog`（全屏卡片式复习对话框）
- ❌ 相关导入和引用

### 第二阶段：复习对话框（待实现）
重新设计复习对话框，支持分模块复习。

**待实现功能：**
1. 根据选择的模块加载题目
2. 卡片式显示题目
3. 显示/隐藏答案
4. 复习结果评价（生疏/困难/掌握/熟练）
5. 进度显示
6. 完成统计

### 第三阶段：复习算法优化（待实现）
优化SM-2算法，提供更好的复习体验。

**待优化：**
1. 根据模块调整复习间隔
2. 记录复习历史
3. 提供复习统计
4. 智能推荐复习时间

## 当前状态

### 已实现
1. **模块选择对话框**
   - 文件：`src/mistake_book/ui/dialogs/review_module_selector.py`
   - 功能：选择科目和题型
   - 状态：✅ 完成

2. **主窗口集成**
   - 文件：`src/mistake_book/ui/main_window.py`
   - 功能：调用模块选择器，获取筛选条件
   - 状态：✅ 完成（暂时显示提示信息）

### 待实现
1. **新的复习对话框**
   - 文件：待创建
   - 功能：实际的复习界面
   - 状态：❌ 待实现

2. **复习服务优化**
   - 文件：`src/mistake_book/services/review_service.py`
   - 功能：支持分模块复习
   - 状态：⚠️ 部分完成（已支持筛选条件）

## 文件变更

### 新增文件
- `src/mistake_book/ui/dialogs/review_module_selector.py`
- `docs/review_module_selector.md`
- `docs/review_refactoring.md`（本文件）

### 删除文件
- `src/mistake_book/ui/dialogs/review_dialog.py`（旧的复习对话框）

### 修改文件
- `src/mistake_book/ui/main_window.py`
  - 移除`ReviewDialog`导入
  - 修改`start_review()`方法
  - 添加`on_module_selected_for_review()`方法
  
- `src/mistake_book/ui/dialogs/__init__.py`
  - 移除`ReviewDialog`导出
  - 添加`ReviewModuleSelectorDialog`导出

## 临时方案
在新的复习对话框实现之前，选择模块后会显示一个提示信息框：
```
准备复习：数学 - 选择题
共 10 道题目

复习对话框开发中...
```

## 下一步计划

### 1. 设计新的复习对话框
- 简洁的卡片式设计
- 支持键盘快捷键
- 显示进度和统计
- 流畅的动画效果

### 2. 实现复习逻辑
- 题目加载和切换
- 答案显示/隐藏
- 复习结果处理
- 数据更新

### 3. 优化用户体验
- 添加复习提示
- 记录复习历史
- 提供复习统计
- 智能推荐

## 技术债务
1. 旧的`ReviewDialog`已删除，需要重新实现
2. `ReviewScheduler`和`ReviewService`需要适配新的分模块复习
3. 需要设计复习历史记录表

## 兼容性
- 数据库结构无需修改
- 现有的复习数据（interval, repetitions等）继续使用
- SM-2算法保持不变

## 测试计划
1. 测试模块选择功能
2. 测试筛选条件正确传递
3. 测试题目数量统计准确
4. 测试"复习全部"功能
5. 待新对话框实现后，测试完整复习流程

## 总结
第一阶段的模块选择功能已完成，用户现在可以选择要复习的科目和题型。旧的复习对话框已删除，等待重新实现更好的复习界面。整个重构过程采用渐进式方式，确保每个阶段都可以独立测试和验证。
