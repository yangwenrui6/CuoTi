# 复习模块选择功能

## 功能概述
在开始复习前，用户可以选择要复习的具体模块（科目+题型），实现分模块复习，提高复习效率。

## 需求背景
原有的复习功能直接复习所有到期题目，没有分类选择：
1. 用户可能只想复习某个科目的题目
2. 用户可能只想复习某种题型的题目
3. 一次性复习所有题目可能太多，用户希望分批复习

## 功能设计

### 1. 模块选择对话框
点击"开始复习"后，首先弹出模块选择对话框，包含：

#### 左侧：科目列表
- 显示所有科目及题目数量
- 格式：`科目名称 (题目数量)`
- 例如：`数学 (25题)`
- 点击科目后，右侧显示该科目的题型

#### 右侧：题型列表
- 初始状态禁用，选择科目后启用
- 显示该科目下的所有题型及题目数量
- 格式：`题型名称 (题目数量)`
- 例如：`选择题 (10题)`

#### 选择提示
- 动态显示当前选择状态
- 未选择：`请先选择科目，然后选择题型`
- 选择科目：`已选择科目：数学，请选择题型`
- 选择完成：`✅ 已选择：数学 - 选择题 (10题)`

#### 底部按钮
1. **📖 复习全部**：复习所有题目，不分模块
2. **🚀 开始复习**：复习选定的模块（需先选择科目和题型）
3. **取消**：关闭对话框

### 2. 工作流程

```
用户点击"开始复习"
    ↓
显示模块选择对话框
    ↓
用户选择科目（左侧列表）
    ↓
右侧显示该科目的题型列表
    ↓
用户选择题型
    ↓
显示选择确认信息
    ↓
用户点击"开始复习"
    ↓
根据选择的模块筛选题目
    ↓
打开复习对话框开始复习
```

### 3. 数据加载

#### 统计科目和题型
```python
# 遍历所有题目
for question in all_questions:
    subject = question['subject']
    question_type = question['question_type']
    
    # 收集科目和题型
    # 统计每个模块的题目数量
```

#### 数据结构
```python
subjects: List[str]  # 所有科目列表
question_types: Dict[str, List[str]]  # {科目: [题型列表]}
question_counts: Dict[str, Dict[str, int]]  # {科目: {题型: 数量}}
```

### 4. 信号机制

#### 定义信号
```python
module_selected = pyqtSignal(str, str)  # (subject, question_type)
```

#### 发送信号
- 选择特定模块：`module_selected.emit(subject, question_type)`
- 复习全部：`module_selected.emit("", "")`（空字符串表示全部）

#### 接收信号
主窗口连接信号，根据选择构建筛选条件：
```python
filters = {}
if subject:
    filters['subject'] = subject
if question_type:
    filters['question_type'] = question_type

due_questions = review_service.get_due_questions(filters)
```

## 实现细节

### 1. UI设计

#### 对话框尺寸
- 最小尺寸：700x500
- 响应式布局，可调整大小

#### 颜色方案
- 科目列表：蓝色主题（#3498db）
- 题型列表：绿色主题（#27ae60）
- 选中项：对应主题色背景，白色文字
- 悬停效果：浅色背景（#e3f2fd / #e8f5e9）

#### 字体大小
- 标题：18pt，加粗
- 分组标题：13pt，加粗
- 列表项：12pt
- 提示文字：11pt

### 2. 交互逻辑

#### 科目选择
1. 点击科目项
2. 清空题型列表
3. 加载该科目的题型
4. 启用题型列表
5. 更新提示文字
6. 禁用"开始复习"按钮

#### 题型选择
1. 点击题型项
2. 记录选择
3. 更新提示文字（显示完整选择）
4. 启用"开始复习"按钮

#### 复习全部
1. 统计总题目数
2. 弹出确认对话框
3. 确认后发送空字符串信号
4. 关闭对话框

### 3. 数据筛选

#### 特定模块
```python
filters = {
    'subject': '数学',
    'question_type': '选择题'
}
```

#### 全部题目
```python
filters = {}  # 空字典，不筛选
```

## 修改文件

### 新增文件
- `src/mistake_book/ui/dialogs/review_module_selector.py`
  - ReviewModuleSelectorDialog类
  - 模块选择对话框实现

### 修改文件
- `src/mistake_book/ui/main_window.py`
  - `start_review()` - 显示模块选择对话框
  - `on_module_selected_for_review()` - 处理模块选择

- `src/mistake_book/ui/dialogs/__init__.py`
  - 导出ReviewModuleSelectorDialog

## 用户体验

### 1. 清晰的视觉层次
- 左右分栏，逻辑清晰
- 科目和题型用不同颜色区分
- 选中状态明显

### 2. 实时反馈
- 选择后立即显示题目数量
- 动态更新提示信息
- 按钮状态实时变化

### 3. 灵活的选择
- 可以选择特定模块
- 可以复习全部
- 可以随时取消

### 4. 防误操作
- 复习全部需要确认
- 未选择完成时禁用开始按钮
- 清晰的提示信息

## 优点

### 1. 分模块复习
- 用户可以专注于某个科目
- 可以针对性复习某种题型
- 避免一次性复习太多题目

### 2. 数据可视化
- 直观显示每个模块的题目数量
- 帮助用户了解题库分布
- 便于制定复习计划

### 3. 灵活性
- 支持精确选择
- 支持全部复习
- 满足不同复习需求

### 4. 易用性
- 两步选择，简单直观
- 实时反馈，不会迷失
- 快捷操作，效率高

## 测试建议

### 功能测试
1. 测试科目列表正确显示
2. 测试题型列表根据科目动态加载
3. 测试题目数量统计准确
4. 测试选择后正确筛选题目
5. 测试"复习全部"功能
6. 测试取消操作

### UI测试
1. 测试列表项悬停效果
2. 测试选中状态样式
3. 测试按钮启用/禁用状态
4. 测试提示文字动态更新
5. 测试对话框大小和布局

### 边界测试
1. 没有题目时的显示
2. 只有一个科目时的显示
3. 科目下没有题型时的处理
4. 选择后没有到期题目的提示

## 后续优化建议

### 1. 记住上次选择
保存用户上次选择的模块，下次打开时自动选中

### 2. 显示到期题目数
在题目数量旁边显示到期数量：`数学 (25题，5题到期)`

### 3. 多选支持
允许同时选择多个科目或题型

### 4. 搜索功能
当科目或题型很多时，提供搜索框快速定位

### 5. 统计图表
显示各模块的复习进度图表

### 6. 快捷选择
提供"最近复习"、"最多错题"等快捷选项

## 总结
模块选择功能让复习更加灵活和高效，用户可以根据自己的需求选择要复习的内容，避免盲目复习所有题目。清晰的UI设计和实时反馈让选择过程简单直观。
